# version: '3.8'

# services:
#   # ---------------------------------------------
#   # 1. D·ªäCH V·ª§ C∆† S·ªû D·ªÆ LI·ªÜU (MYSQL)
#   # ---------------------------------------------
#   mysql:
#     image: mysql:8
#     container_name: mysql-container
#     restart: unless-stopped
#     environment:
#       MYSQL_ROOT_PASSWORD: root
#       MYSQL_DATABASE: medical_booking
#     ports:
#       - "3306:3306"
#     volumes:
#       - mysql_data:/var/lib/mysql
#       - ./init_db:/docker-entrypoint-initdb.d
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$$MYSQL_ROOT_PASSWORD"]
#       interval: 10s
#       timeout: 5s
#       retries: 5
#     networks:
#       - app-network

#   # ---------------------------------------------
#   # 2. D·ªäCH V·ª§ ·ª®NG D·ª§NG (BACKEND & FRONTEND)
#   # ---------------------------------------------
#   backend:
#     build: ./backend
#     container_name: backend-container
#     restart: unless-stopped
#     ports:
#       - "8080:8080"
#     environment:
#       SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/medical_booking
#       SPRING_DATASOURCE_USERNAME: root
#       SPRING_DATASOURCE_PASSWORD: root
#     depends_on:
#       mysql:
#         condition: service_healthy
#     networks:
#       - app-network

#   frontend:
#     build: ./frontend
#     container_name: frontend-container
#     restart: unless-stopped
#     ports:
#       - "3000:3000"
#     depends_on:
#       - backend
#     networks:
#       - app-network

#   # ---------------------------------------------
#   # 3. D·ªäCH V·ª§ X·ª¨ L√ù D·ªÆ LI·ªÜU (ELASTICSEARCH, RABBITMQ, LOGSTASH)
#   # ---------------------------------------------

#   # 3.1. Elasticsearch (L∆∞u tr·ªØ v√† T√¨m ki·∫øm)
#   elasticsearch:
#     image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
#     container_name: elasticsearch
#     restart: unless-stopped
#     environment:
#       - discovery.type=single-node
#       - xpack.security.enabled=false
#       - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
#     ulimits:
#       memlock:
#         soft: -1
#         hard: -1
#     ports:
#       - "9200:9200"
#       - "9300:9300"
#     volumes:
#       - esdata:/usr/share/elasticsearch/data
#     networks:
#       - app-network

#   # 3.2. RabbitMQ (H√†ng ƒë·ª£i tin nh·∫Øn)
#   rabbitmq:
#     image: rabbitmq:3.12-management
#     container_name: rabbitmq
#     hostname: rabbitmq_host
#     restart: unless-stopped
#     environment:
#       - RABBITMQ_DEFAULT_USER=user
#       - RABBITMQ_DEFAULT_PASS=password
#     ports:
#       - "5672:5672" # AMQP
#       - "15672:15672" # Management UI
#     networks:
#       - app-network

#   # 3.3. Logstash (C·∫ßu n·ªëi RabbitMQ -> Elasticsearch)
#   logstash:
#     image: docker.elastic.co/logstash/logstash:8.11.0
#     container_name: logstash
#     restart: unless-stopped
#     volumes:
#       - ./logstash/config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf:ro
#     environment:
#       - "LS_JAVA_OPTS=-Xms256m -Xmx256m"
#     depends_on:
#       # Logstash ph·∫£i ch·ªù c·∫£ hai d·ªãch v·ª• n√†y s·∫µn s√†ng
#       elasticsearch:
#         condition: service_started
#       rabbitmq:
#         condition: service_started
#     networks:
#       - app-network

# # ---------------------------------------------
# # VOLUMES V√Ä NETWORKS
# # ---------------------------------------------
# volumes:
#   mysql_data:
#   esdata:
#     driver: local

# networks:
#   app-network:
#     driver: bridge


# version: "3.8"
# services:
#   mysql:
#     image: mysql:8
#     container_name: mysql-container
#     restart: unless-stopped 
#     environment:
#       MYSQL_ROOT_PASSWORD: root
#       MYSQL_DATABASE: medical_booking
#     ports:
#       - "3306:3306"
#     volumes:
#       - mysql_data:/var/lib/mysql
#       - ./init_db:/docker-entrypoint-initdb.d
    
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$$MYSQL_ROOT_PASSWORD"]
#       interval: 10s
#       timeout: 5s
#       retries: 5

#   backend:
#     build: ./backend
#     container_name: backend-container
#     restart: unless-stopped
#     ports:
#       - "8080:8080"
#     environment:
#       SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/medical_booking
#       SPRING_DATASOURCE_USERNAME: root
#       SPRING_DATASOURCE_PASSWORD: root
    
#     # üåü C·∫¨P NH·∫¨T DEPENDS_ON ƒê·ªÇ CH·ªú MYSQL S·∫¥N S√ÄNG
#     depends_on:
#       mysql:
#         condition: service_healthy # Backend ch·ªâ kh·ªüi ƒë·ªông khi MySQL b√°o tr·∫°ng th√°i HEALTHY
#     # üåü END DEPENDS_ON

#   frontend:
#     build: ./frontend
#     container_name: frontend-container
#     restart: unless-stopped
#     ports:
#       - "3000:3000"
#     depends_on:
#       - backend

# volumes:
#   mysql_data:


#set up docker-compose deploy
version: "3.8"
services:

  backend:
    build: ./backend
    container_name: backend-container
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://medical-booking-db-booking-medical.i.aivencloud.com:11878/defaultdb?ssl-mode=REQUIRED
      SPRING_DATASOURCE_USERNAME: avnadmin
      SPRING_DATASOURCE_PASSWORD: "MAT_KHAU_AIVEN_CUA_BAN" 

  frontend:
    build: ./frontend
    container_name: frontend-container
    restart: unless-stopped
    ports:
      - "3000:3000"
    depends_on:
      - backend
    environment:
      - REACT_APP_API_URL=http://localhost:8080 
